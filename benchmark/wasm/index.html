<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>latex_math_evaluator WASM Benchmark</title>
    <style>
        body {
            font-family: system-ui, -apple-system, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
            background: #1a1a2e;
            color: #eee;
        }
        h1 {
            color: #00d9ff;
        }
        #output {
            background: #16213e;
            border-radius: 8px;
            padding: 20px;
            font-family: 'Monaco', 'Menlo', monospace;
            font-size: 14px;
            white-space: pre-wrap;
            min-height: 300px;
            border: 1px solid #0f3460;
        }
        .success { color: #00ff88; }
        .error { color: #ff6b6b; }
        .info { color: #00d9ff; }
        button {
            background: #00d9ff;
            color: #1a1a2e;
            border: none;
            padding: 10px 20px;
            font-size: 16px;
            border-radius: 5px;
            cursor: pointer;
            margin: 10px 0;
        }
        button:hover {
            background: #00b8d4;
        }
        button:disabled {
            background: #555;
            cursor: not-allowed;
        }
    </style>
</head>
<body>
    <h1>ðŸ§® latex_math_evaluator WASM Benchmark</h1>
    <p>This runs the Dart package compiled to WebAssembly (WasmGC).</p>
    <p><strong>Requirements:</strong> Chrome 119+, Firefox 120+, or Edge 119+ (WasmGC support)</p>
    
    <button id="runBtn" onclick="runBenchmark()">Run Benchmark</button>
    
    <div id="output">Click "Run Benchmark" to start...</div>

    <script type="module">
        import { compileStreaming } from './benchmark.mjs';
        
        window.runBenchmark = async function() {
            const output = document.getElementById('output');
            const btn = document.getElementById('runBtn');
            
            btn.disabled = true;
            output.innerHTML = '<span class="info">Loading WASM module...</span>\n';
            
            try {
                // Compile using fetch (streaming)
                output.innerHTML += 'Fetching benchmark.wasm...\n';
                const compiledApp = await compileStreaming(fetch('./benchmark.wasm'));
                
                output.innerHTML += '<span class="success">WASM compiled successfully!</span>\n';
                output.innerHTML += 'Instantiating...\n';
                
                // Instantiate
                const instantiatedApp = await compiledApp.instantiate({});
                
                output.innerHTML += '<span class="success">WASM instantiated!</span>\n\n';
                output.innerHTML += 'Running benchmarks...\n\n';
                
                // Override console.log to capture output
                const originalLog = console.log;
                console.log = function(msg) {
                    output.innerHTML += msg + '\n';
                    output.scrollTop = output.scrollHeight;
                    originalLog.apply(console, arguments);
                };
                
                // Run the Dart main function
                instantiatedApp.invokeMain();
                
                console.log = originalLog;
                output.innerHTML += '\n<span class="success">Done!</span>';
                
            } catch (e) {
                output.innerHTML += '<span class="error">Error: ' + e.message + '</span>\n';
                output.innerHTML += '<span class="error">' + e.stack + '</span>\n\n';
                output.innerHTML += '<span class="info">Note: WasmGC requires Chrome 119+, Firefox 120+, or Edge 119+</span>';
                console.error(e);
            }
            
            btn.disabled = false;
        };
    </script>
</body>
</html>
